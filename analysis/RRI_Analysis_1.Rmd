---
title: "RR1: Wrangle & Analysis, I"
output: html_notebook
---

Set working directory to file path. 

Load packages and collect info on files:
```{r message=FALSE, warning=FALSE}
library(tidyverse)
# set path to current directory
data_path <- c('../../RRI_data_materials/data')
source('funs.R') # two functions you need in this script

all_data <- list.files(data_path, pattern = ".csv") # all csv files
participant_IDs <- unlist(lapply(strsplit(all_data,"_"), '[[', 1)) # extract participant ID
true_participants <- !stringr::str_starts(participant_IDs, "00") # remove those IDs that start with 00, such as 001 or 002

true_data <- all_data[true_participants]
filtered_data_files <- filter_data(true_data)
```


Wrangle data
```{r}
wrangled_data <- wrangle_data(data_path, filtered_data_files)

data <- wrangled_data$data
demographics <- wrangled_data$demgraphics

```


Let's take a look!
```{r message=FALSE, warning=FALSE}
rating_data <- data[!is.na(data$rating),] %>% mutate(rating = as.numeric(rating))

rating_summary <- rating_data %>% group_by(wm, condition, question_n) %>% summarise(mean_rating = mean(rating),
                                                                sd_rating = sd(rating),
                                                                se_rating = sd_rating/sqrt(nrow(rating_data)))

ratings_mu_summary <- rating_data %>% group_by(wm, condition) %>% summarise(mean_rating = mean(rating),
                                                                sd_rating = sd(rating),
                                                                se_rating = sd_rating/sqrt(nrow(rating_data)))

# mean, se ratings ~ prestige level * working memory * question
ggplot(rating_summary) + 
 geom_point(aes(question_n, mean_rating, color = condition)) +
 geom_errorbar(aes(x = question_n, y = mean_rating, ymin = mean_rating-se_rating, ymax = mean_rating+se_rating, color = condition)) +
 geom_line(aes(question_n, mean_rating, group = condition, color = condition)) +
  facet_grid(. ~ wm)

# mean, se ratings ~ prestige level * working memory 
ggplot(ratings_mu_summary) + 
 geom_point(aes(1, mean_rating, color = condition)) +
 geom_errorbar(aes(x = 1, y = mean_rating, ymin = mean_rating-se_rating, ymax = mean_rating+se_rating, color = condition)) +
 #geom_line(aes(question_n, mean_rating, group = condition, color = condition)) +
  facet_grid(. ~ wm)

```

```{r message=FALSE, warning=FALSE}
genre_summary <- rating_data %>% group_by(wm, condition, genre) %>% summarise(mean_rating = mean(rating),
                                                                sd_rating = sd(rating),
                                                                se_rating = sd_rating/sqrt(nrow(rating_data)))


# mean, se ratings ~ prestige level * working memory * question
ggplot(genre_summary) + 
 geom_point(aes(genre, mean_rating, color = condition)) +
 #geom_col(aes(genre, scale(mean_rating), color = condition, fill = condition), alpha = 0.7, position = position_dodge()) + 
 geom_errorbar(aes(x = genre, y = mean_rating, ymin = mean_rating-se_rating, ymax = mean_rating+se_rating, color = condition)) +
 geom_line(aes(genre, mean_rating, group = condition, color = condition)) +
  facet_grid(. ~ wm)
```

